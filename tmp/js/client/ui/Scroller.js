define(["module","conditioner/Observer","util/element","util/event","util/ResponsiveWindow","hammer","ui/ScrollerPaging","ui/ScrollerControls"],function(e,t,n,r,i,s,o,u){var a=function(e,t){this._element=e,this._options=t,this._initialize()};return a.prototype={_initialize:function(){this._index=this._options.start?this._options.start:0,this._scroller=document.createElement("div"),this._scroller.className="scroller",this._wrapper=document.createElement("div"),this._wrapper.className="scroller-wrapper",this._wrapper.style.opacity="0",this._wrapper.appendChild(this._scroller),n.insertAfter(this._wrapper,this._element),this._scroller.appendChild(this._element),this._element.classList.add("scroller-items"),this._items=this.getItems(),this._measure(),this._options.paging&&this._itemsVisible<this._items.length&&(this._paging=new o(this,this._options),this._pagingNode=this._paging.getIndex(),this._wrapper.appendChild(this._pagingNode),this._setIndexBind=this._setIndex.bind(this),t.subscribe(this._paging,"click",this._setIndexBind)),this._options.controls&&(this._controls=new u(this,this._options),this._controlsNode=this._controls.getElement(),this._wrapper.appendChild(this._controlsNode)),this._responsiveWindow=i.getInstance(),this._onResizeBind=this._onResize.bind(this),t.subscribe(this._responsiveWindow,"resize",this._onResizeBind),this._options.auto&&this._autoplay(),this._onMouseEnterBind=this._onMouseEnter.bind(this),this._onMouseLeaveBind=this._onMouseLeave.bind(this),this._onKeyDownBind=this._onKeyDown.bind(this),this._element.addEventListener("mouseover",this._onMouseEnterBind,!1),this._element.addEventListener("mouseout",this._onMouseLeaveBind,!1),window.addEventListener("keydown",this._onKeyDownBind,!1),this._hammer=new s(this._element,{drag_lock_to_axis:!0}),this._handleHammerBind=this._handleHammer.bind(this),this.enable(),this._setIndex(this._getIndex()),Modernizr.cssanimations&&r.addPrefixedEvent(this._element,"TransitionEnd",this._update.bind(this));var e=this;setTimeout(function(){e._wrapper.style.opacity=1},300)},enable:function(){this._hammer.on("release dragleft dragright swipeleft swiperight",this._handleHammerBind)},disable:function(){this._hammer.off("release dragleft dragright swipeleft swiperight",this._handleHammerBind)},_handleHammer:function(e){Modernizr.csstransitions&&this._element.classList.remove("animate"),e.gesture&&e.type!="release"&&!this._delta&&e.gesture.direction!=="up"&&e.gesture.direction!=="down"&&e.gesture.preventDefault();switch(e.type){case"dragright":case"dragleft":var t=parseFloat(this._getCurrentOffset(),10),n=e.gesture.deltaX,r=t+n;this._delta=r,this._direction=e.gesture.direction,Modernizr.csstransitions&&r<0&&(this._element.style.mozTransform="translateX("+r+"px)",this._element.style.msTransform="translateX("+r+"px)",this._element.style.WebkitTransform="translate3d("+r+"px,0,0)",this._element.style.Transform="translate3d("+r+"px,0,0)");break;case"swipeleft":e.gesture.stopDetect(),this.navigate("next");break;case"swiperight":e.gesture.stopDetect(),this.navigate("prev");break;case"release":if(!this._delta)return;this._onRelease(),Math.abs(this._delta)>this._itemWidth/2?this._direction=="left"?this.navigate("next"):this.navigate("prev"):this._setIndex(this._getIndex())}},_setIndexFromOffset:function(e){var t=Math.floor(parseFloat(e.toString().replace("-",""),10)/this._itemWidth);this._index=t,this._update()},_autoplay:function(){var e=this;this._autoplayTimer=setInterval(function(){e.navigate("next")},this._options.auto)},_onRelease:function(){Modernizr.csstransitions&&this._wrapper.classList.remove("dragging")},_onMouseEnter:function(){this._hovering=!0;if(!this._options.auto)return;clearInterval(this._autoplayTimer)},_onMouseLeave:function(){this._hovering=!1;if(!this._options.auto)return;this._autoplay()},_onKeyDown:function(e){if(this._hovering)switch(e.keyCode){case 37:this.navigate("prev");break;case 39:this.navigate("next")}},navigate:function(e){var t=this._getIndex(),n=this._options.pagingPerItem?1:this._itemsVisible;switch(e){case"next":t+=n;break;case"prev":t-=n}t<0&&(t=0),this._setIndex(t)},_setIndex:function(e){Modernizr.csstransitions&&this._element.classList.add("animate"),e=this._capIndex(e);var n;Modernizr.csstransitions?(n=this._getOffsetForIndex(e),this._element.style.MozTransform="translate3d("+n+"px,0,0)",this._element.style.msTransform="translateX("+n+"px)",this._element.style.WebkitTransform="translate3d("+n+"px,0,0)",this._element.style.Transform="translate3d("+n+"px,0,0)"):this._element.style.left=this._getOffsetForIndex(e)+"px",this._index=e;var r=this._getMaxOffset();n+="",(!Modernizr.cssanimations||n.replace("-","")==r)&&this._update(),t.publish(this,"change",this._index),this._delta=null},_getOffsetForIndex:function(e){var t,n=this._getMaxOffset();if(this._options.center){var r=this._getScrollerWidth()/2,i=this._getItemWidth();t=r-this._itemWidth*e-i/2}else t=this._itemWidth*e;return t.toString().replace("-","")>n&&!this._options.center?"-"+n:this._options.center?t:t>0?"-"+t:0},_getCurrentOffset:function(){var e=this._getOffsetForIndex(this._index);return e},_update:function(){this._paging&&this._paging.setIndex(this._getIndex()),this._controls&&(this._index===0?this._controls.hidePrev():this._controls.showPrev(),this._index===this._items.length-1?this._controls.hideNext():this._controls.showNext()),this._wrapper.classList.add("scroller-wrapper-initialized")},_getIndex:function(){return this._index},_capIndex:function(e){return this._options.loop?(e=e>this._items.length-1?0:e,e=e<0?this._items.length-1:e):(e=e>this._items.length-1?this._items.length-1:e,e=e<0?0:e),e},getItems:function(){return this._element.parentNode.querySelectorAll(".scroller-items > li")},_getItemWidth:function(){return n.getWidth(this._items[0])},getVisibleAmount:function(){return this._itemsVisible},getAmount:function(){return Math.ceil(this._items.length/this._itemsVisible)},_getScrollerWidth:function(){return n.getWidth(this._scroller)},getElement:function(){return this._element},_onResize:function(){this._wrapper.classList.remove("scroller-wrapper-initialized");var e=this._items.length,t=0;for(;t<e;t++)this._items[t].style.width="";this._element.style.width="";var n=this;this._resizeTimer&&clearTimeout(this._resizeTimer),this._resizeTimer=setTimeout(function(){n._options.paging&&n._itemsVisible<n._items.length&&n._paging.render(),n._measure(),n._setIndex(n._getIndex())},500)},_getMaxOffset:function(){if(this._itemsVisible>this._items.length)return 0;var e=0;return this._options.center?(e=this._items.length*this._getItemWidth()-this._getScrollerWidth(),e+=this._getScrollerWidth()/2,e-=this._getItemWidth()/2):e=this._items.length*this._getItemWidth()-this._getScrollerWidth(),e},_measure:function(){this._itemWidth=this._getItemWidth(),this._scrollerWidth=this._getScrollerWidth();var e=this._items.length,t=0;for(;t<e;t++)this._items[t].style.width=this._itemWidth+"px";this._element.style.width=e*this._itemWidth+"px",this._itemsVisible=Math.floor(this._scrollerWidth/this._itemWidth),this._itemsVisible<1&&(this._itemsVisible=1),this._scroller.classList.add("scroller-initialized")},unload:function(){n.remove(this._wrapper),n.insertAfter(this._element,this._wrapper),this._scroller.appendChild(this._element),this._element.classList.remove("scroller-items"),t.unsubscribe(this._responsiveWindow,"resize",this._onResizeBind),this._element.removeEventListener("touchstart",this._onTouchStartBind),this._element.removeEventListener("mouseover",this._onMouseEnterBind),this._element.removeEventListener("mouseout",this._onMouseLeaveBind),this._element.removeEventListener("mousedown",this._onMouseDownBind),this._element.removeEventListener("mouseup",this._onMouseUpBind),window.removeEventListener("keydown",this._onKeyDownBind),this._options.paging&&this._paging.unload(),this._options.controls&&this._controls.unload()}},a});