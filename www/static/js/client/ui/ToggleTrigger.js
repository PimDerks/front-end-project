define(["module","conditioner/Observer","ui/Toggle","ui/ToggleManager","util/element"],function(e,t,n,r,i){var s=1200,o=null,u={x:0,y:0},a=function(e,t){n.call(this,e,t)},f=a.prototype=Object.create(n.prototype);return f._initialize=function(){n.prototype._initialize.call(this),this._manager=r.getInstance(),this._onMouseDownBind=this._onMouseDown.bind(this),this._onMouseUpBind=this._onMouseUp.bind(this),this._onMouseMoveBind=this._onMouseMove.bind(this),this._onKeyUpBind=this._onKeyUp.bind(this),this._onChangeBind=this._onChange.bind(this),this._bindEvents()},f._bindEvents=function(){var e=this._element.nodeName.toLowerCase(),t=this._element.getAttribute("type");switch(e){case"input":t=t.toLowerCase();switch(t){case"radio":var n=this._element.getAttribute("name");this._inputs=document.querySelectorAll("[name='"+n+"']");var r=this._inputs.length,i=0;for(;i<r;i++)this._inputs[i].addEventListener("change",this._onChangeBind,!1);break;case"checkbox":this._element.addEventListener("change",this._onChangeBind,!1)}break;default:this._element.addEventListener("mousedown",this._onMouseDownBind,!1),this._element.addEventListener("keyup",this._onKeyUpBind,!1),this._element.addEventListener("click",function(e){return e.preventDefault(),!1},!1)}},f._onChange=function(e){e.target===this._element&&this._element.checked?this._activateTargetToggles():this._deactivateTargetToggles()},f._getToggles=function(){var e=this._element.getAttribute("data-toggle-target"),t;if(!e)return;e=e.split(","),t=e.length,this._toggles=[];for(t>0;t--;){var n=this._manager.getToggleById(e[t]);n&&this._toggles.push(n)}return this._toggles},f._onKeyUp=function(e){e.keyCode==13&&this._toggleTargetToggles()},f._onMouseDown=function(e){o=i.parent(e.target,".toggle");if(!o)return;u.x=e.pageX,u.y=e.pageY,document.addEventListener("mousemove",this._onMouseMoveBind,!1),this._element.addEventListener("mouseup",this._onMouseUpBind,!1)},f._onMouseUp=function(e){e.preventDefault(),e.stopPropagation();var t=i.parent(e.target,".toggle");t==o&&this._toggleTargetToggles()},f._onMouseMove=function(e){var t,n={x:e.pageX,y:e.pageY};t=Math.pow(u.x-n.x,2)+Math.pow(u.y-n.y,2),t>s&&(document.removeEventListener("mousemove",this._onMouseMoveBind,!1),this._element.removeEventListener("mouseup",this._onMouseUpBind,!1))},f._activateTargetToggles=function(){this._toggles||this._getToggles();if(this._toggles){var e=this._toggles.length;for(e>0;e--;)this._toggles[e].activate()}this.activate()},f._deactivateTargetToggles=function(){this._toggles||this._getToggles();if(this._toggles){var e=this._toggles.length;for(e>0;e--;)this._toggles[e].deactivate()}this.deactivate()},f._toggleTargetToggles=function(){this._toggles||this._getToggles();if(this._toggles&&this._toggles){var e=this._toggles.length;for(e>0;e--;)this._toggles[e].toggle()}this.toggle()},f.unload=function(){n.prototype.unload.call(this);if(this._inputs){var e=this._inputs.length,t=0;for(;t<e;t++)this._inputs[t].removeEventListener("change",this._onChangeBind)}this._element.removeEventListener("mousedown",this._onMouseDownBind,!1),this._element.removeEventListener("mouseup",this._onMouseUpBind,!1),this._element.removeEventListener("mousemove",this._onMouseMoveBind,!1),this._element.removeEventListener("keyup",this._onKeyUpBind,!1),this._element.removeEventListener("change",this._onChangeBind,!1)},a});